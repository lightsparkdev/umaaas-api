post:
  summary: Retry an incomplete payment
  description: >
    In the case where a customer is debited but the Lightning payment fails to complete, integrators can retry the payment using this endpoint.


    Payments retried with this endpoint will debit from the sender and deliver to the recipient the same amount as the original quote.

    As the Grid API does not persist customer PII, retries need to start with a lookup request to retrieve the original quote's recipient counter party data requirements then pass that sender information in the request body.

    Before calling this endpoint, you should reach out to the Lightspark team to investigate the underlying issue.  As part of resolution, they'll update the transaction to the appropriate state.  The quote / transaction to retry must be in a `FAILED` or `REFUNDED` state.
  operationId: retryQuote
  tags:
    - Cross-Currency Transfers
  security:
    - BasicAuth: []
  parameters:
    - name: quoteId
      in: path
      description: ID of the quote to retry
      required: true
      schema:
        type: string
  requestBody:
    content:
      application/json:
        schema:
          type: object
          required:
            - lookupId
          properties:
            lookupId:
              type: string
              description: >-
                Unique identifier for the prior receiver uma address lookup
                request.
              example: Lookup:019542f5-b3e7-1d02-0000-000000000009
            senderCustomerInfo:
              type: object
              additionalProperties: true
              description: >
                Key-value pairs of information about the sender which was
                requested by the counterparty (recipient) institution.

                Any fields specified in `requiredPayerDataFields` from the
                response of the `/receiver/{receiverUmaAddress}` (lookupUma)
                endpoint

                MUST be provided here if they were requested. If the
                counterparty (recipient) institution did not request any
                information,

                this field can be omitted.
              example:
                FULL_NAME: Jane Receiver
                NATIONALITY: FR
  responses:
    '201':
      description: >
        Quote created successfully. The response includes payment instructions

        that the client can use to execute the payment through their banking
        provider.
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/quotes/Quote.yaml
    '400':
      description: Bad request - Missing or invalid parameters
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/common/Error.yaml
    '401':
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/common/Error.yaml
    '422':
      description: |
        Unprocessable Entity - Additional counterparty information required,
        or the payment cannot be completed for another reason.
      content:
        application/json:
          schema:
            allOf:
              - $ref: ../../components/schemas/common/Error.yaml
              - type: object
                properties:
                  code:
                    example: MISSING_MANDATORY_USER_INFO
                  message:
                    example: Additional counterparty information required
                  details:
                    example:
                      requiredFields:
                        - TAX_ID
                        - REGISTRATION_NUMBER
